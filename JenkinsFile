pipeline {
    agent any
    stages{
        stage('Git Checkout'){
          steps{
           
             git credentialsId: 'gitcred', url: 'https://github.com/vaishalijain8/Vaishaliproject1.git'
          }
        }
        
        stage('Build'){
          steps{

             sh """
                cd hello-world-war
                mvn clean install
                mv target/*.war target/demo.war
            
             """
          }
        }

        stage('Upload Artifacts'){
          steps{

             withAWS(credentials: 'AWS-cred', region: 'us-east-2') {
                
               s3Upload acl: 'Private', bucket: 'jenkins-test1', file: 'demo.war', path: 'target/demo.war', text: 'Test upload', workingDir: 'hello-world-war'
             }
          }
        }

        stage('Deploy'){
          steps{

             sh """
                cp hello-world-war/target/demo.war /opt/tomcat8/webapps/
                /opt/tomcat8/bin/shutdown.sh
                /opt/tomcat8/bin/startup.sh               

             """
          }
        }

    }
}
